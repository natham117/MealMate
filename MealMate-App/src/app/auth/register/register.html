<div class="auth-card">
    <h1>Registrieren</h1>

    <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
        <!-- Vorname -->
        <label for="firstName">Vorname</label>
        <input
            id="firstName"
            name="firstName"
            type="text"
            placeholder="z.B. Max"
            autocomplete="name"
            formControlName="firstName"
        />

        <!-- Nachname -->
        <label for="lastName">Nachname</label>
        <input
            id="lastName"
            name="lastName"
            type="text"
            placeholder="z.B. Mustermann"
            autocomplete="name"
            formControlName="lastName"
        />

        <!-- E-Mail -->
        <label for="email">E-Mail</label>
        <input
            id="email"
            name="email"
            type="email"
            placeholder="z. B. max@mustermann.de"
            autocomplete="email"
            formControlName="email"
        />
        @if (form.get('email')?.touched && form.get('email')?.errors) {
            <div class="error">
                Bitte E-Mail-Richtlinien beachten.
            </div>
        }

        <!-- Passwortbereich -->
        <div formGroupName="passwordGroup">
            <!-- Passwort -->
            <label for="password">Passwort</label>
            <input
                id="password"
                name="password"
                type="password"
                placeholder="********"
                autocomplete="new-password"
                formControlName="password"
            />

            <!-- Fehlermeldungen für Passwort -->
            @if (form.get('passwordGroup.password')?.touched && form.get('passwordGroup.password')?.errors) {
                <div class="error">
                    Bitte Passwort-Richtlinien beachten
                </div>
            }

            <!-- Passwort wiederholen -->
            <label for="passwordConfirm">Passwort wiederholen</label>
            <input
                id="passwordConfirm"
                name="passwordConfirm"
                type="password"
                placeholder="Passwort erneut eingeben"
                autocomplete="new-password"
                formControlName="passwordConfirm"
            />

            <!-- Fehlermeldung für Nicht-Übereinstimmung -->
            @if (form.get('passwordGroup')?.touched && form.get('passwordGroup')?.errors?.['passwordsNotMatch']) {
                <div class="error">
                    Passwörter stimmen nicht überein.
                </div>
            }
        </div>
        
        <!-- Submit -->
        <button type="submit">Konto erstellen</button>

        <p class="hint">
            Schon registriert?
            <a routerLink="/login">Jetzt anmelden.</a>
        </p>
    </form>
</div>

@if (modalOpen()) {
    <div class="mm-modal-backdrop" (click)="closeModal()"></div>
    <div class="mm-modal">
        <h2>{{ modalTitle() }}</h2>

        @if (modalBody() === null) {
            @if (showEmailRules()) {
                <h3>E-Mail-Richtlinien</h3>
                <ul>
                    <li>Format: <code>local-part@domain</code></li>
                    <li>Local-part: Buchstaben/Ziffern und . ! # $ % &amp; ' * + / = ? ^ _ | &lbrace; ~ &rbrace; ` -</li>
                    <li>Local-part: Nicht mit . beginnen/enden, keine ".."</li>
                    <li>Local-part: Max. 64 Zeichen</li>
                    <li>Domain: Labels durch Punkt, jedes Label beginnt/endet mit Buchstabe/Zahl, "-" nur in der Mitte</li>
                    <li>Domain: Label maximal 64 Zeichen, gesamt maximal 254 Zeichen</li>
                    <li>TLD: mindestens 2 Buchstaben (z. B. <code>de</code>, <code>com</code>)</li>
                    <li>Keine Leer- oder Steuerzeichen</li>
                </ul>
            }

            @if (showPasswordRules()) {
                <h3>Passwort-Richtlinien</h3>
                <ul>
                    <li>Mindestens 8 Zeichen</li>
                    <li>Mindestens eine Zahl</li>
                    <li>Mindestens ein Groß-/Kleinbuchstabe</li>
                    <li>Keine Leer- oder Unicode-Steuerzeichen</li>
                    <li>Passwort und Wiederholung müssen übereinstimmen</li>
                </ul>
            }
        } @else {
            <p>{{ modalBody() }}</p>
        }

        <div class="mm-modal-actions">
            <button type="button" (click)="closeModal()">OK</button>
        </div>
    </div>
}